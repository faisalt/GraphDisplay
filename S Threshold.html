<html>
	<head>
	
		<title>Graph Display - Threshold Study</title>
		
		<!-- Styles --> 
		<link rel="stylesheet" type="text/css" href="common.css">
		<style type="text/css">
			
			#datainfo { display: none; }
			
			.axislabel.y.target div.text { background-color: purple; } 
			.axislabel.y.target div.bar { background-color: purple; } 
			
		</style>
		
		<script type="text/javascript" src="js/jquery-1.8.2.js"></script>
		<script type="text/javascript" src="js/jquery-ui-1.9.1.custom.min.js"></script>
		<script type="text/javascript" src="js/jquery.nearest.min.js"></script>
		<script type="text/javascript" src="js/reconnecting-websocket.js"></script>
		<script type="text/javascript" src="js/ubidisplays-multitouch-0.8.js"></script>
		<script type="text/javascript" src="graph.js" type="text/javascript"></script>
		<script type="text/javascript" src="datasets.js"></script>
		
	</head>
	<body>
		
		<!-- STUDY BUTTONS -->
		<div id="studyheader">
			<p>Threshold Study</p>
			<ul id="modes">
				<li mode="P1T"><span>P1T</span><span>Physical Column Control<span></li>
				<!--<li mode="P1"><span>P1</span><span>Physical Manual Hide<span></li>
				<li mode="P2"><span>P2</span><span>Physical Assisted Hide<span></li>
				<li mode="P3"><span>P3</span><span>Physical Tap Comparison<span></li>
				<li mode="P4"><span>P4</span><span>Physical End Column Hide<span></li>-->
			</ul>
		</div>
		
		<!-- FUNCTION RENDER -->
		<div id="datainfo">
			<span class="title"></span>
			<br/>
			<br/>
			<span class="row"></span>
			<span class="col"></span>
			<br/>
			<span class="value"></span>
		</div>
		
		<script>
			// Constants
			var STUDY = 8383;					// Port for connection to the study behaviour.
			var dims = null;					// Physical dimensions.
			var USE_DATASET_COLOURS = true;		// Do we use the colours from the data set when plotting infovis data.
			var COMPARE_TIME = ANIM * 3;		// Comparison time.
			
			

			var baseSet = null;
			var lowerThresh = 0.0;
			//var upperThresh = 0.0;
			function setLowerThresh(r, c, curr, tgt) { lowerThresh = curr; applyThreshold(); }
			//function setUpperThresh(r, c, curr, tgt) { upperThresh = curr; }
			
			function applyThreshold() {
				
				/*
				var orig = deepCopy(_LastDataSet);
				
				
				var data = identity();
				for (var row=0; row<10; row++)
					for (var col=0; col<10; col++)
						data[row][col] = orig[row][col] < lowerThresh ? 0.0 : orig[row][col];
				
				
				console.log( adjustZRange(lowerThresh) );
				blitData(data);
				
				_LastDataSet = deepCopy(orig);
				*/
			}
			
			/** Responses to auto-touch (i.e. interaction with physical bars). */
			function handleAutoTouch(touched, pushed, pulled) {
				
				/*
				if (mode == "P1T")
				{
					//for (var i=0; i<touched.length; ++i)
					//{
					//	if (touched[i].col == 0 && touched[i].row == 0) { lowerThresh = touched[i].actualheight; }
					//	if (touched[i].col == 9 && touched[i].row == 0) { upperThresh = touched[i].actualheight; }
					//}
				}
				
				// 
				console.log( "pull/push " + rf(lowerThresh, 2) + " - "  + rf(upperThresh, 2) );
				*/
			}
			 
			/** Reset the study mode. */
			function setMode(mode){
				
				// If we need auto-touch enabled.
				if (mode.startsWith("P"))
					setAutoTouch(true);
				else
					setAutoTouch(false);
				
				// Plot the data set.
				graphDataSet("co2");
				
				function thresh(x, y, callback, tgt, darken) {
					send("subscribez", 	{x:x, y:y, callback:callback });
					send("override", 	{x:x, y:y, z:(tgt||0.1), darken:(darken||1.0) });
					after(ANIM, function(){ send("freeze", {x:x, y:y, state:true}) });
				}
				
				// Prepare P1.
				if (mode == "P1T")
				{
					thresh(0, 0, "setLowerThresh", 0.1);
					//thresh(0, 9, "setUpperThresh", 1.0);
				}
				
			}
			
			
			/** Start up the study. */
			$(document).ready(function() {
				
				// Start the touch events.
				initTouch();
				
				// Connect to the graph.
				initComms(STUDY, function(){ console.log("Connected to Graph Behaviour"); initModes("P1T"); });
				
				// Graph dimensions.
				dims = dimensions();
				
				// Add axes.
				drawAxes();
			});
			
			
		</script>
		
	</body>
</html>
